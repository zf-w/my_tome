---
description: "这里大抵是之枫的二〇二四年七月第三周的日记."
long_title: "二〇二四年七月第三周日记 - 之枫"
---

# 七月十六日周二

今天早上起的比较晚, 到达目的地也比较迟. 煎饼吃了若干. 我切牛排的时候不小心把筷子也切掉了一部分.

晚上开车的时候为了让别的车, 感觉可能在实线的位置变道了, 还有摄像头咔咔地拍, 不知道会不会有什么后果. 新的域名也先买下了.

# 七月十七日周三

今天早上投了简历, 继续调整整理了文件夹的结构, 命名, 简单修改了一下"zf-w" repository 的命名方式. 下午继续学习, 晚上做每日一题. 今天的每日一题还是关于递归和 Binary Tree 的, 还蛮有趣的. 虽说也并没有什么是没趣的.
还正常锻了炼. 晚上继续看小谢尔顿, 还挺逗的. 不过我觉得第二季的某一集对于小谢尔顿找校霸霸凌他哥哥的事情我觉得编剧处理的没有像以往一样正能量.

晚上还继续思考了到底小书的文件夹命名之类要如何设计才能兼顾美观和实用与效率. 我不希望对于一个 Markdown 文件, 我需要读取其中的内容才能知道其是否是 private 的, 以及标题等, 这样可以省下很多空间. 特别是未来某些页面可能不需要更新的时候. 如果还要读取, 不就浪费了资源.

# 七月十八日周四

该仔细地思考一下整个 book project 的架构, 渲染的流程, Markdown 的文件夹的表达形式, CSS 们的表达形式, 我自定义的 JS 代码的表达形式. 就像我考虑到书的文件夹思路不希望用额外的文件去表达名字, 我想这些 JavaScript 文件最好也不要既要在代码里 hard wire 进去, 又在 runtime 的时候检查对应的文件在不在. 最好是统一一下. 要么全都 hard wire, 编译进代码, 要么就完全用一个文件夹去表示我的各种自定义前端模块. 考虑到灵活性的因素, 我目前想选中后者, 听上去感觉很酷.

不过第一步还是先把代码中整个 Markdown Book 的读取先捋顺了吧, 我究竟在第一步的时候需要哪些信息, 不需要哪些信息, 这些必定是要想好了的. 然后我再去整理一下代码的结构.

# 七月十九日周五

## 随笔

我在想假如我写日记, 该以什么方式储存是最为直观的. 我想如果只是一个巨型字符串的话, 大概对于计算机和人都不是很友好的. 关键还是我想强调什么, 这大概能够决定数据结构的重心. 我既然纠结于"质本洁来还洁去", 一颗像"HTML"语言似的树或许能非常直观, 起码能看出哪些事情结束了. 它大概能强调一件事没结束之前不能开始另一个吧. 否则括号就对应不上了

今天继续是非常充实的一天. 说个题外话, 我觉得减少和人的交流某种角度上使我的体验变得更纯粹, 更只属于我: 如果要是有第二个人的话, 恐怕我写的东西就要加一堆密才可以放到这里来.

## 开发

今天我自己的事情主要是实现了周四也就是昨天的想法, 我把整个小书的架构用一个 Prefix Tree 表示, 减少重复字符串的使用, 这是以前有的. 今天的进步主要在于不把所以 Markdown 文件都读入进树中, 而是只记录对应的文件位置和 URL 位置. 原先, 我都是在 Markdown 文件里定义这个页面的标题和描述, 但是我想, 有没有可能直接用文件名就把这些都定义了呢? 毕竟 Navigation Bar 目前只需要对应 URL 和标题. 只要我设计一种文件命名方式, 就可以在不读取文件的情况下直接从文件名中提取. 这个设计在今天被验证确实可以实现.

虽然确实也有一些小问题, 比如说 Root 的 index 页面之前没有 path, 也就没法放标题, 只好暂时先 hardcode 一下.

今天遇到的 bug 主要有两个, 一个是把一个文件是否是以"Readme.md"的形式附属在文件夹上, 还是单纯的叶文件弄反了. 我用`is_dir()`去判断是否是`file`了, 哈哈. 第二个 bug 是我又忘了在递归 backtracking 时, 如果提前退出该 pop 的东西也要 pop, 否则路径就乱了.

# 七月二十日周六

今天的每日一题是个像是数独一样的, 我看了提示做出来的, 还蛮有趣的, 大概不算在普通的那些相对套路比较明显的题里.

今天的个人项目开发主要是实现了在我的"zhifeng_mdbook"中, 对比旧的渲染出的 HTML 文件和源头的 Markdown 文件的新旧程度. 因为我想如果要是 HTML 已经比 Markdown 要新了, 那就不用花时间去再渲染了.

最终这一部分也是基本按照设想实现了, 中间遇到了一些小困难有, url 的储存是个问题, 一方面它们都是 Book 那颗树的一部分, 一方面检查文件的时候又必须是完整的一个 String? 大概. 我想理论上肯定可以用包含一堆 String 的 Iterator 也能起到同样的效果, 但是我想这个需求太小了, 也不知道操作系统之类允不允许. 嗯, 我想重复复制一下已经记录的信息也不算是什么大的罪过.

我还看了一下 Rust Standard Libary File System 模块的 File, 我想确实应该`File::open`是不把所以 bytes 从别处读取到内存的, 大概`File::read`之类才会读取. 我想这样子应该我只读取 Metadata 去对比新旧的想法是可行的.

我还发现了一个思路上的错漏, 就是"out directory"其实并不是真正文件都被写入的那个文件夹. 其实应该是"out directory"加上"web base". 我一开始错把它俩混为一谈, 导致树里没有对应的东西. 这个设计主要还是为了一致吧, 总不能 out 在一个不是"web base"的地方吧: 这样可能会产生冲突. 所以还是"out directory"代表整个"static file service"部分的 root, 而"web base"指的是其中的某个文件夹. 否则, 如果文件的位置不对, 网站大概是没法正常运行的.

未来的计划首先是要调整一下分工, 让"OutDirTree"去负责所有文件的写入, 这样子它才能判断哪些是没用到的. 然后要把"CSS Tree"和"JS Tree"也加入到渲染的过程中来, 这样子也能确保所有的需要的文件都能够找到对应而不至于"404". 然后要把"private leaf"文件的"navigation"部分去掉. 兴许还要加一下旧结构的删除, 这个大概需要看"OutDirTree"的标注. 然后我也要设计一下"JS Tree"和我的自定义模块之间的关系, 或许很大一部分代码我并不需要 hard code 进 Rust, 因为 JS 文件夹的结构就反应了自定义模块的位置. 只是预渲染就不能进行了, 这一部分可能必须要 hard code.

另外, 不知道今天[(Encrypted)](#KPEKOFLPFEIFFGKIIHCLJIDDFIEEHBOKEFDPBCCGEOJNBKNCICMBKGKAOPHCHGDNPDGL)冲了没冲特别辣的辣酱.

# 七月二十一日周日

## 日常

今天早上去买了麦当劳, 我觉得确实板烧鸡腿堡是美国麦当劳所没有的.

## 开发

今天我突然意识到, 对于那些不需要"Pre-order Traversal"的"Prefix"文件夹树, 我不太需要一个`BTreeMap`去把它们排好序, 用`HashMap`就够了. 于是我新增了一个默认的`HashMap`的"wrapper". 我倒是不想之间在"Foreign"的"struct"上添加东西, 万一别人有不同的考虑呢.

之后我整理了一下那几个对于"Tree"的"Cursor"的命名. 大概不是所有的树都用"key"这种形式去"randomly access"某个 node 的某个 children 的. 所以我想还是暂时命名成 "TreeCursorKeyNavTrait"之类. 我想这样能更清楚一点.
之后的一个设想就是重新设计一个"Linked" Tree, 每个 node 连到自己的 sibling 和 children 的第一个, 还有 parent.这样子就可以统一 HTML 的 Tree 和 Book 的 Tree, 多么奇妙!

然后我调整了旧的"OutDirTree", 它应该是整体"WebsiteManager"的一部分, 毕竟未来各种素材, JavaScript, 和 CSS 都需要经过它. 只有那样才能判断哪些文件是新的, 哪些是不需要的可以删除的.

我突然意识到".md"的后缀忘了从 Title 里删掉了. 删一下哈哈.

我想, 偶尔肯定也有需要全部重新生成 HTML 的可能, 那样的话还是得加个特殊的判断.
